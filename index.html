<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weather Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#9ca3af;
      --text:#e5e7eb;
      --accent:#22d3ee;
      --accent-weak:#164e63;
      --border:#1f2937;
      --shadow: 0 10px 25px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, #0b1220, var(--bg));
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:32px 16px;
    }
    .app{
      width:100%;
      max-width:940px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom:16px;
    }
    h1{
      margin:0;
      font-weight:700;
      letter-spacing:.3px;
      font-size:24px;
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .search{
      display:flex;
      align-items:center;
      gap:8px;
      background: var(--card);
      border:1px solid var(--border);
      padding:8px 10px;
      border-radius:10px;
      box-shadow: var(--shadow);
    }
    .search input{
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      width:200px;
    }
    .btn{
      background: linear-gradient(180deg, #22d3ee, #1ea9c0);
      border:none;
      color:#062a34;
      font-weight:700;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      transition: transform .05s ease, filter .15s ease;
    }
    .btn:active{transform: translateY(1px)}
    .unit-toggle{
      display:flex;
      border:1px solid var(--border);
      background: var(--card);
      border-radius:10px;
      padding:4px;
      box-shadow: var(--shadow);
    }
    .unit-toggle button{
      background:transparent;
      color:var(--muted);
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      min-width:50px;
    }
    .unit-toggle button.active{
      background: rgba(34,211,238,.15);
      color: var(--accent);
      border:1px solid var(--accent-weak);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap:16px;
    }
    @media (max-width: 840px){
      .grid{ grid-template-columns: 1fr; }
      .search input{ width:140px; }
    }
    .card{
      background:linear-gradient(180deg, rgba(17,24,39,.7), rgba(17,24,39,.6));
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow: var(--shadow);
    }
    .current{
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap:10px;
    }
    .location{
      font-size:18px;
      font-weight:700;
    }
    .muted{color:var(--muted)}
    .temp{
      font-size:56px;
      font-weight:800;
      line-height:1;
    }
    .temp .unit{
      font-size:20px;
      color:var(--muted);
      font-weight:700;
      margin-left:6px;
    }
    .row{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
    }
    .icon{
      font-size:28px;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.25));
    }
    .small-icon{ font-size:20px; }
    .divider{
      height:1px; background: var(--border); margin:12px 0;
    }

    /* Forecast table */
    .forecast{
      margin-top:6px;
    }
    .forecast h3{
      margin:0 0 10px;
      font-size:16px;
      color: #cbd5e1;
      letter-spacing:.3px;
    }
    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(2,6,23,.35);
    }
    th, td{
      padding:10px 12px;
      text-align:left;
      border-bottom:1px solid var(--border);
    }
    th{
      color:#a7b0c0;
      font-weight:700;
      font-size:13px;
      background: rgba(2,6,23,.5);
    }
    tbody tr:last-child td{ border-bottom:none; }
    .hi{ color:#e2e8f0; font-weight:700; }
    .lo{ color:#94a3b8; }
    .cond{ color:#cbd5e1; }
    .error{
      color:#fca5a5; 
      background: rgba(239,68,68,.12);
      border:1px solid rgba(239,68,68,.35);
      padding:10px 12px; border-radius:10px;
      margin-top:10px;
    }
    .loading{ color:#a5b4fc; }
    footer{
      margin-top:18px;
      color: var(--muted);
      font-size:12px;
      text-align:center;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(15,23,42,.5);
      padding:6px 10px;
      border-radius:999px;
      color:#cbd5e1;
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Weather Dashboard</h1>
      <div class="controls">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="cityInput" placeholder="Search city (e.g., London)" />
          <button id="searchBtn" class="btn">Search</button>
        </div>
        <div class="unit-toggle" role="group" aria-label="Temperature unit">
          <button id="cBtn" class="active" aria-pressed="true">¬∞C</button>
          <button id="fBtn" aria-pressed="false">¬∞F</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card" id="currentCard" aria-live="polite">
        <div class="current">
          <div>
            <div class="location" id="locationName">‚Äî</div>
            <div class="muted" id="asOf">Loading...</div>
          </div>
          <div class="row">
            <span class="icon" id="currentIcon" aria-hidden="true">‚òÄÔ∏è</span>
            <div class="temp" id="currentTemp">‚Äî<span class="unit" id="tempUnit">¬∞C</span></div>
          </div>
        </div>
        <div class="divider"></div>
        <div class="row">
          <span class="pill" id="cond">‚Äî</span>
          <span class="pill" id="wind">‚Äî</span>
        </div>
        <div id="errorBox" class="error" style="display:none"></div>
      </section>

      <section class="card forecast" id="forecastCard">
        <h3>3-Day Forecast</h3>
        <div id="forecastLoading" class="loading">Loading forecast‚Ä¶</div>
        <table id="forecastTable" style="display:none">
          <thead>
            <tr>
              <th style="width:30%">Day</th>
              <th style="width:20%">Weather</th>
              <th style="width:25%">High / Low</th>
              <th style="width:25%">Conditions</th>
            </tr>
          </thead>
          <tbody id="forecastBody">
          </tbody>
        </table>
      </section>
    </div>

    <footer>
      Data by Open‚ÄëMeteo ‚Ä¢ No API key required
    </footer>
  </div>

  <script>
    (function(){
      const state = {
        unit: 'celsius', // or 'fahrenheit'
        coords: null,
        placeLabel: '',
        timezone: 'auto'
      };

      const els = {
        cityInput: document.getElementById('cityInput'),
        searchBtn: document.getElementById('searchBtn'),
        cBtn: document.getElementById('cBtn'),
        fBtn: document.getElementById('fBtn'),
        locationName: document.getElementById('locationName'),
        asOf: document.getElementById('asOf'),
        currentTemp: document.getElementById('currentTemp'),
        currentIcon: document.getElementById('currentIcon'),
        tempUnit: document.getElementById('tempUnit'),
        cond: document.getElementById('cond'),
        wind: document.getElementById('wind'),
        errorBox: document.getElementById('errorBox'),
        forecastLoading: document.getElementById('forecastLoading'),
        forecastTable: document.getElementById('forecastTable'),
        forecastBody: document.getElementById('forecastBody')
      };

      function setUnitUI(unit){
        state.unit = unit;
        els.cBtn.classList.toggle('active', unit === 'celsius');
        els.cBtn.setAttribute('aria-pressed', unit === 'celsius');
        els.fBtn.classList.toggle('active', unit === 'fahrenheit');
        els.fBtn.setAttribute('aria-pressed', unit === 'fahrenheit');
        els.tempUnit.textContent = unit === 'celsius' ? '¬∞C' : '¬∞F';
      }

      function fmtDayName(isoDate, tz){
        try {
          return new Intl.DateTimeFormat(undefined, { weekday: 'short', timeZone: tz || 'UTC' }).format(new Date(isoDate + 'T00:00:00'));
        } catch {
          return new Date(isoDate).toLocaleDateString(undefined, { weekday:'short' });
        }
      }

      function fmtAsOf(ts, tz, abbr){
        try{
          const d = new Date(ts);
          const opt = { hour:'2-digit', minute:'2-digit', timeZone: tz || undefined };
          const t = new Intl.DateTimeFormat(undefined, opt).format(d);
          return `As of ${t}${abbr ? ' ' + abbr : ''}`;
        }catch{
          return `As of ${new Date(ts).toLocaleTimeString()}`;
        }
      }

      function codeToInfo(code){
        // Open-Meteo weathercode mapping (simplified)
        // Returns {icon, label}
        const c = Number(code);
        if (c === 0) return { icon: '‚òÄÔ∏è', label: 'Clear sky' };
        if (c === 1) return { icon: 'üå§Ô∏è', label: 'Mainly clear' };
        if (c === 2) return { icon: '‚õÖ', label: 'Partly cloudy' };
        if (c === 3) return { icon: '‚òÅÔ∏è', label: 'Overcast' };
        if (c === 45 || c === 48) return { icon: 'üå´Ô∏è', label: 'Fog' };
        if ([51,53,55].includes(c)) return { icon: 'üå¶Ô∏è', label: 'Drizzle' };
        if ([56,57].includes(c)) return { icon: 'üåßÔ∏è', label: 'Freezing drizzle' };
        if ([61,63,65].includes(c)) return { icon: 'üåßÔ∏è', label: 'Rain' };
        if ([66,67].includes(c)) return { icon: 'üåßÔ∏è', label: 'Freezing rain' };
        if ([71,73,75].includes(c)) return { icon: '‚ùÑÔ∏è', label: 'Snow' };
        if (c === 77) return { icon: 'üå®Ô∏è', label: 'Snow grains' };
        if ([80,81,82].includes(c)) return { icon: 'üå¶Ô∏è', label: 'Rain showers' };
        if ([85,86].includes(c)) return { icon: 'üå®Ô∏è', label: 'Snow showers' };
        if (c === 95) return { icon: '‚õàÔ∏è', label: 'Thunderstorm' };
        if ([96,99].includes(c)) return { icon: '‚õàÔ∏è', label: 'Thunderstorm w/ hail' };
        return { icon: '‚ùî', label: 'N/A' };
      }

      async function geocodeCity(name){
        const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`;
        const r = await fetch(url);
        if (!r.ok) throw new Error('Network error');
        const data = await r.json();
        if (!data.results || !data.results.length) throw new Error('City not found');
        const g = data.results[0];
        const label = `${g.name}${g.admin1 ? ', ' + g.admin1 : ''}${g.country ? ', ' + g.country : ''}`;
        return { lat: g.latitude, lon: g.longitude, label, tz: g.timezone || 'auto' };
      }

      async function fetchWeather(lat, lon){
        const tempUnit = state.unit === 'celsius' ? 'celsius' : 'fahrenheit';
        const windUnit = state.unit === 'celsius' ? 'kmh' : 'mph';
        // fetch 4 days to get next 3 beyond today
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weathercode,wind_speed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min&temperature_unit=${tempUnit}&windspeed_unit=${windUnit}&forecast_days=4&timezone=auto`;
        const r = await fetch(url);
        if (!r.ok) throw new Error('Weather fetch failed');
        return r.json();
      }

      function renderCurrent(data){
        const { current, timezone, timezone_abbreviation } = data;
        const info = codeToInfo(current.weathercode);
        els.currentIcon.textContent = info.icon;
        const tRounded = Math.round(current.temperature_2m);
        els.currentTemp.innerHTML = `${tRounded}<span class="unit" id="tempUnit">${state.unit === 'celsius' ? '¬∞C' : '¬∞F'}</span>`;
        els.cond.textContent = info.label;
        const windUnitLabel = state.unit === 'celsius' ? 'km/h' : 'mph';
        els.wind.textContent = `Wind ${Math.round(current.wind_speed_10m)} ${windUnitLabel}`;
        els.asOf.textContent = fmtAsOf(current.time, timezone, timezone_abbreviation);
        els.locationName.textContent = state.placeLabel || '‚Äî';
      }

      function renderForecast(data){
        const { daily, timezone } = data;
        els.forecastBody.innerHTML = '';
        // We want next 3 days beyond today => indices 1..3 if available
        const rows = [];
        for (let i = 1; i < Math.min(4, daily.time.length); i++){
          const day = daily.time[i];
          const hi = Math.round(daily.temperature_2m_max[i]);
          const lo = Math.round(daily.temperature_2m_min[i]);
          const info = codeToInfo(daily.weathercode[i]);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${fmtDayName(day, timezone)}</td>
            <td><span class="small-icon" aria-hidden="true">${info.icon}</span></td>
            <td><span class="hi">${hi}¬∞</span> <span class="lo">/ ${lo}¬∞</span></td>
            <td class="cond">${info.label}</td>
          `;
          rows.push(tr);
        }
        rows.forEach(r => els.forecastBody.appendChild(r));
        els.forecastLoading.style.display = 'none';
        els.forecastTable.style.display = rows.length ? 'table' : 'none';
      }

      function showError(msg){
        els.errorBox.textContent = msg;
        els.errorBox.style.display = 'block';
      }
      function clearError(){
        els.errorBox.textContent = '';
        els.errorBox.style.display = 'none';
      }

      async function loadByCity(name){
        clearError();
        els.asOf.textContent = 'Loading‚Ä¶';
        els.forecastLoading.style.display = 'block';
        els.forecastTable.style.display = 'none';
        try{
          const geo = await geocodeCity(name);
          state.coords = { lat: geo.lat, lon: geo.lon };
          state.placeLabel = geo.label;
          state.timezone = geo.tz || 'auto';
          const data = await fetchWeather(geo.lat, geo.lon);
          renderCurrent(data);
          renderForecast(data);
        }catch(err){
          showError(err.message || 'Something went wrong.');
        }
      }

      async function reloadIfCoords(){
        if (!state.coords) return;
        els.forecastLoading.style.display = 'block';
        els.forecastTable.style.display = 'none';
        try{
          const data = await fetchWeather(state.coords.lat, state.coords.lon);
          renderCurrent(data);
          renderForecast(data);
        }catch(err){
          showError(err.message || 'Failed to refresh weather.');
        }
      }

      // Events
      els.searchBtn.addEventListener('click', () => {
        const q = (els.cityInput.value || '').trim();
        if (!q) return;
        loadByCity(q);
      });
      els.cityInput.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          els.searchBtn.click();
        }
      });
      els.cBtn.addEventListener('click', () => {
        if (state.unit !== 'celsius'){
          setUnitUI('celsius');
          reloadIfCoords();
        }
      });
      els.fBtn.addEventListener('click', () => {
        if (state.unit !== 'fahrenheit'){
          setUnitUI('fahrenheit');
          reloadIfCoords();
        }
      });

      // Init
      setUnitUI('celsius');
      // Optional: try geolocation, fallback to default city
      const defaultCity = 'New York';
      if ('geolocation' in navigator){
        navigator.geolocation.getCurrentPosition(async pos => {
          try{
            state.coords = { lat: pos.coords.latitude, lon: pos.coords.longitude };
            state.placeLabel = 'Your location';
            els.asOf.textContent = 'Loading‚Ä¶';
            const data = await fetchWeather(state.coords.lat, state.coords.lon);
            renderCurrent(data);
            renderForecast(data);
          }catch{
            loadByCity(defaultCity);
          }
        }, () => loadByCity(defaultCity), { timeout: 4000 });
      } else {
        loadByCity(defaultCity);
      }
    })();
  </script>
</body>
</html>